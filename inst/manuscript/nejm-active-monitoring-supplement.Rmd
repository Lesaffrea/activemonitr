---
title: 'Methodological supplement for: Reducing the threat of imported infectious
  disease outbreaks with active monitoring'
author: "Nicholas G Reich, Neil M Vora, Jay K Varma, Justin Lessler"
date: "April, 2016"
output:
  pdf_document:
    fig_caption: yes
    fig_height: 5
    fig_width: 5
    md_extensions: +implicit_figures
  html_document: default
  word_document:
    fig_caption: yes
    fig_height: 5
    fig_width: 5
    md_extensions: +implicit_figures
csl: the-new-england-journal-of-medicine.csl
bibliography: active-monitoring.bib
---

```{r global-options, include=FALSE}
knitr::opts_chunk$set(fig.width=7.5, fig.height=5, fig.path='figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)

```


# Estimation of incubation period

All incubation period observations were treated as single interval-censored data, which means that intervals of possible incubation periods were observed rather than exact values [@Reich:2009jq]. The data used for these analyses are publicly available at [[LINK TO COME]]. 

We fitted the observed data for each disease to a gamma probability distribution using Markov Chain Monte Carlo (MCMC) methods with the Metropolis-Hastings algorithm [[add citation]]. The gamma distribution is one of several "heavy-tailed" distributions often used to describe incubation periods, and aligns with assumptions made by previous researchers. [@Virlogeux:2016ty] We assumed uninformative, flat priors on the shape and scale parameters of the gamma distribution. We ran multiple MCMC chains, thinning each to remove autocorrelation within chains and evaluating between-chain agreement with [[TEST NAME]], to achieve final empirical posterior distributions with 1 million samples. Two-dimensional credible regions were estimated using kernel density estimation on the joint posterior distribution of gamma parameters with flexible bandwidth matrices estimated by multivariate smooth cross-validation.[@Duong:2005fk;@Duong:2015wn] 

# Estimates of probabilities of infection

To provide first approximations of the probabilities of infection associated with each exposure risk category, we used available data on cases diagnosed in the United States (as the numerator) and number of individuals monitored in the United States (as the denominator). Because no cases were diagnosed in the United States after monitoring programs were implemented, we extrapolated the number of monitored individuals to cover the entire duration of the outbreak.

We used public data on the four cases diagnosed in the United States to classify these cases into appropriate exposure-risk categories.[@CentersforDiseaseControlandPrevention:VbDBWqNH;@CentersforDiseaseControlandPrevention:lyxYF_Hp] Although some news reports have indicated that the Dallas index case may have had direct exposure to infected individuals, reports of initial statements made by the index case do not cite this known exposure, therefore he would have likely been classified as being at low (but not zero) risk. The two Dallas healthcare workers, per CDC exposure risk definitions, would also have been considered low (but not zero) risk.[@Chevalier:2014uk] The New York City case would have been classified as some risk, due to his recent work in an Ebola treatment center abroad.[@Yacisin:2015wm]


case | date of symptom onset |exposure risk category
---------------|---------|---------
Dallas index case | Sept 25, 2014 | low (but not zero)
Dallas healthcare worker 1 | Oct 11, 2014 | low (but not zero)
Dallas healthcare worker 2 | Oct 11, 2014 |low (but not zero)
NYC doctor | Oct 23, 2014 | some risk


```{r}
## in order: guinea, liberia, sierra leone
## data from spreadsheet downloaded from http://www.cdc.gov/vhf/ebola/outbreaks/2014-west-africa/cumulative-cases-graphs.html
## data in ebola-inc-per/data/graph1-cumulative-reported-cases-all.xlsx

cases_by_nov5_2014 <- c(1731, 6525, 4759)
cases_by_mar11_2015 <- c(3285, 9343, 11619)
cases_by_feb10_2016 <- c(3804, 10675, 14124)

cases_during <- cases_by_mar11_2015 - cases_by_nov5_2014

case_fraction <- sum(cases_during)/sum(cases_by_feb10_2016)
```

Stehling-Ariza et al.[@StehlingAriza:2015vd] reported `r format(9512 + 527)` monitored low but not zero risk individuals and 315 some or high risk individuals over a four month period (November 3, 2014 through March 8, 2015). Based on World Health Organization case report data downloaded from the CDC website [@CentersforDiseaseControlandPrevention:EQU9LnIa], we estimate that `r round(100*case_fraction)`% of all reported Ebola cases in Guinea, Liberia, and Sierra Leone through February 2016 occurred during this four month period. 

From these numbers, we extrapolate that `r format(9512 + 527)`/  `r round(case_fraction,2)` or roughly `r format(round((9512 + 527)/case_fraction, -3))` individuals at low (but not zero) risk could have been eligible for monitoring over the course of the entire outbreak.  Similarly, we extrapolate that `r round(315/case_fraction, -3)` some or high risk individuals could have been eligible for monitoring in the United States over the entire course of the outbreak. Both extrapolations have been rounded to the nearest thousand.


CDC risk level | Number of cases reported in the United States | Estimated denominator for whole outbreak | Estimated probability of developing Ebola ($\phi$)
---------------|---------|-------------|-------------------------
"Low (but not zero) risk" | 3 | `r format(round((9512 + 527)/case_fraction, -3))` | 1/10,000
"Some risk or high risk" | 1 | `r round(315/case_fraction, -3)` |  1/1,000

# Estimates of probability of developing an unrelated infection

```{r, echo=FALSE}
n_monitored <- 5321
n_symptomatic <- 103
s.21 <- 1-n_symptomatic*.3/n_monitored
lam <- 1-s.21^(1/21)
```


There were 5,321 non-unique persons who underwent active monitoring by DOHMH during October 25, 2014 to November 7, 2015. This represented 5,003 unique persons, some of whom were monitored on more than one occasion. During the course of these individuals being actively monitored by DOHMH, some individuals developed symptoms that could possibly have indicated the onset of Ebola.  Specifically, there were 103 occasions of an individual experiencing fever, diarrhea, vomiting, or unexplained bleeding/bruising, representing `r round(n_symptomatic/n_monitored*100)`% of the total number of monitored individuals. These symptomatic individuals were evaluated by DOHMH staff, and some were referred for follow-up testing for Ebola at a hospital. Approximately 30% of those who developed symptoms were eventually hospitalized to rule-out Ebola as a cause of the symptoms. 

Our aim was to develop a simple model for the rate at which individuals were falling ill from causes other than Ebola. To do this, we performed a simple discrete-time survival analysis, assuming that the hazard of developing symptoms from other sources was constant over time. We observed a single aggregated datapoint, that after 21 days of monitoring, only a small fraction of individuals had reported symptoms that required hospitalization: `r n_symptomatic` x  0.3 / `r n_monitored` = `r round(n_symptomatic*0.3/n_monitored, 4)`. Assuming that every day during a monitoring period had the same risk of developing symptoms, we can write the survival function, the probability that an individual would be symptom free after $t$ days, as
$$S(t) = (1-\lambda)^t$$
By plugging in $S(21) =$ 1- `r round(n_symptomatic*0.3/n_monitored, 4)`, we solve for $\lambda$, the constant per-day hazard, and obtain the estimate $\hat\lambda$ = `r round(lam*1000, 2)`/1000. Therefore, for the model below we estimate the probability of a monitored individual developing Ebola-like symptoms during a $d$ day monitoring period as $\theta_d = 1 - (1-\hat\lambda)^d$. 
 

# Probabilistic model

We developed a probabilistic model for evaluating the likelihood that a monitored individual would develop symptoms at different stages of monitoring. This model is based on four key parameters: the probability of a monitored individual developing symptomatic infection ($\phi$), two parameters that define the distribution of incubation periods ($T$ denotes the random variable for incubation periods), and either a fixed or random duration of time between the time of infecting exposure and the onset of active monitoring ($u$). 

The model-based probabilities for the disease of concern (see Figure 1, main text) are calculated as:

outcome  | probability
----------------------|----------------------------------------
does not develop disease of concern | $\pi_1 = 1-\phi$
does not develop disease of concern & not hospitalized for other symptoms | $\pi_1 (1-\theta_d)$
does not develop disease of concern & hospitalized for other symptoms | $\pi_1 \theta_d$
develops disease of concern during active monitoring | $\pi_2 = \phi\cdot Pr(T\leq d+u)$
develops disease of concern after active monitoring | $\pi_3 = \phi\cdot Pr(T > d+u)$

We quantified the uncertainty about the probability for each outcome scenario attributable to parameter uncertainty (in our estimates of the incubation period distribution) and to uncertainty associated with not knowing the time between infection and the beginning of active monitoring. For parameter uncertainty, we computed each outcome scenario probability from a sample of the posterior distribution of gamma parameters for a fixed $u$. For uncertainty in the infection time, we assumed that $u$ was distributed uniformly, and calculated outcome probabilities for a set of random samples from this distribution while holding the gamma parameters fixed at their posterior median values. To account for both uncertainties, we sampled simultaneously from both distributions.

Max $u$ value chosen such that max(u)/2 + m = 90th percentile of T
this implies that for Ebola:
```{r, eval=FALSE}
qq <- mean(qgamma(.90, shape=ebola_gamma_pstr$shape, scale=ebola_gamma_pstr$scale))
2*(qq - mean(ebola_gamma_pstr$median))
```

# Ebola sensitivity analysis
[[to come]]

# References



